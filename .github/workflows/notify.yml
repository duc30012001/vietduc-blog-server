name: Notify on Workflow Completion

on:
    workflow_run:
        workflows: ["*"]
        types:
            - completed

jobs:
    notify:
        runs-on: ubuntu-latest
        if: always()
        steps:
            - name: Calculate Duration
              id: duration
              run: |
                  start_time=$(date -d "${{ github.event.workflow_run.created_at }}" +%s)
                  end_time=$(date -d "${{ github.event.workflow_run.updated_at }}" +%s)
                  duration=$((end_time - start_time))
                  minutes=$((duration / 60))
                  seconds=$((duration % 60))
                  echo "formatted_duration=${minutes}m ${seconds}s" >> $GITHUB_OUTPUT

            - name: Send notification
              uses: appleboy/telegram-action@master
              with:
                  to: ${{ secrets.TELEGRAM_CHAT_ID }}
                  token: ${{ secrets.TELEGRAM_TOKEN }}
                  message: |
                      ğŸ“Œ Repository: [${{ github.repository }}](${{ github.server_url }}/${{ github.repository }})
                      ğŸš€ Workflow: *${{ github.event.workflow_run.name }}* (#${{ github.event.workflow_run.run_number }})
                      ğŸ”” Status: ${{ github.event.workflow_run.conclusion == 'success' && 'âœ… Success' || github.event.workflow_run.conclusion == 'failure' && 'âŒ Failure' || github.event.workflow_run.conclusion == 'cancelled' && 'âš ï¸ Cancelled' || 'â“ Unknown' }}
                      â± Time: ${{ steps.duration.outputs.formatted_duration }}
                      ğŸ”— [View Run](${{ github.event.workflow_run.html_url }})
                  format: markdown
